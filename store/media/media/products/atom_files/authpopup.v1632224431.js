jQuery(function($){(function(){var finalPopup={params:{triggers:$('[data-overlay-trigger]'),overlayClass:'i-overlay',activeOverlay:undefined,changeClasses:false,hideOverlayClass:'i-overlay_hidden',popupClass:'i-popup',processingClass:'i-popup_processing',unchosenButtonClass:'i-button-promo_unchosen',chosenButtonClass:'i-button-promo_chosen',rotateClass:'i-popup_rotated1',rotateClass2:'i-popup_rotated2',groupContClass:'i-popup',groupClass:'i-popup__group',groupHiddenClass:'i-popup__group_hidden',groupExclClass:'i-popup__group_excluded',tabNavClass:'i-nav-tabs',tabContainerClass:'i-popup__tab-container',tabNavItemClass:'i-nav-tabs__link',tabClass:'i-popup__tab-item',activeNavItemClass:'i-nav-tabs__link_active',activeTabClass:'i-popup__tab-item_active',allBody:$('body'),document:$(document),window:$(window),$nextActive:false,isMobile:false,initialSecondText:'Да, я хочу этот подарок!',unchosenText:'Вы отказались от подарка',chosenAltText:'Выбрать другой подарок',unchosenAltText:'Выбрать подарок',keyBodyListener:undefined,clickBodyListener:undefined,firstState:undefined,secondState:undefined,firstStateH:undefined,secondStateH:undefined,escKeyCode:27,additional:{}},init:function($overlays){var params=this.params;params.overlays=$overlays;var $popups=$('.'+params.popupClass,$overlays);params.popups=$popups;params.chooseButtons=$('[data-button-state]',$popups);$('.i-popup__close',$popups).on('click',function(e){if($(this).data('site')){e.preventDefault();location.href=$(this).data('site')}else if($overlays.closest('i-overlay').length||$overlays.hasClass('i-overlay')){e.preventDefault();e.stopPropagation();finalPopup.hideOverlay()}});params.isMobile=params.document.find('html').hasClass('mobile-yes');if(navigator.userAgent.match(/Opera Mobi/i)||Object.prototype.toString.call(window.operamini)==="[object OperaMini]")
params.isOperaMobile=true;params.currentPopup=$overlays.find('.i-popup');params.firstState=finalPopup.params.currentPopup.find('[data-popup-state=first]');params.secondState=finalPopup.params.currentPopup.find('[data-popup-state=second]');params.thirdState=finalPopup.params.currentPopup.find('[data-popup-state=third]');$overlays.data('popup',finalPopup);params.overlays.on('click','[data-button-state]',function(e){if(this.href)
e.preventDefault();var $button=$(this);if($button.data('button-state')=='other'){$('#loginFormRemindLink').click();return}
if($button.data('button-state')=='toreg'){$('#loginFormRegisterLink').click();return}
if($button.data('button-state')=='tologin'){$('#loginFormLoginLink').click();return}
if($button.data('button-state')=='tologinemail'){$('#loginFormLoginLink').click();$('#loginFormLoginEmailLink').click();return}
if($button.data('button-state')=='tologinphone'){$('#loginFormLoginLink').click();$('#loginFormLoginPhoneLink').click();return}
if($button.data('button-state')=='toremind'){$('#loginFormRemindLink').click();return}
if($button.data('button-state')=='tosmsresend'){$('#phoneFormSmsResendLink').click();return}
finalPopup.params.currentPopup=$button.parents('.i-popup');finalPopup.params.firstState=finalPopup.params.currentPopup.find('[data-popup-state=first]');finalPopup.params.secondState=finalPopup.params.currentPopup.find('[data-popup-state=second]');finalPopup.params.thirdState=finalPopup.params.currentPopup.find('[data-popup-state=third]');$overlays.find('[type=password]').val('');try{Auth.copyEmails();Auth.copyPhones();}catch(e){}
finalPopup.changeState($button.data('button-state'),$button);if($button.data('tabLink')){if($button.data('tabLink')=='email'){$overlays.find('.'+params.tabNavItemClass+'[data-tab-link=email]').click();}
if($button.data('tabLink')=='phone'){$overlays.find('.'+params.tabNavItemClass+'[data-tab-link=phone]').click();}}})
var $tabNavItem=$overlays.find('.'+params.tabNavItemClass);var $tabContainer=$overlays.find('.'+params.tabContainerClass);var $tab=$overlays.find('.'+params.tabClass);var isSafari=/constructor/i.test(window.HTMLElement);if(isSafari)$tabContainer.css({transition:'none',overflow:'visible'});$tabNavItem.on('click',function(e){e.preventDefault();params.$nextActive=jQuery('[data-tab-content='+$(this).data('tabLink')+']');$tabNavItem.removeClass(params.activeNavItemClass);$(this).addClass(params.activeNavItemClass);if(!params.isMobile)$tabContainer.css('height',$tabContainer.height());$tab.removeClass(params.activeTabClass);params.$nextActive.addClass(params.activeTabClass);if(!params.isMobile){params.$nextActive.find('input.i-input:not(input[readonly])').first();setTimeout(function(){Auth.showFocus();Auth.hideErrors();},10);}
finalPopup.recalc($overlays);});var $input=$('#formInputLoginPhone');$('#changePhoneButton').on('click',function(e){e.preventDefault();if(!params.isMobile)$tabContainer.css('height',$tabContainer.height());$input.attr('readonly',false);$('#formInputSend').attr('disabled',false);$('#formInputLoginCode').attr('disabled','disabled');Auth.showFocus();$input.parents('.i-popup__tab-item').removeClass('code-sent-state-visible').find('button[type=submit]').text('Отправить SMS с кодом');$('#formInputLoginCode').val('');Auth.hideErrors();finalPopup.recalc($overlays);});},open:function($overlays){var params=this.params,finalPopup=this;if(!params.isMobile){finalPopup.checkScrollbar();finalPopup.setScrollbar()};params.activeOverlay=$overlays.removeClass(params.hideOverlayClass);if(params.isMobile){if(window.innerWidth>767){params.isTablet=true;finalPopup.initiScroll()};if(!params.isTablet)
params.window.scrollTop(0)}else
finalPopup.adjustDialog();params.allGroups=params.activeOverlay.find('.'+params.groupClass);params.allBody.parents('html').addClass('html_has-overlay');params.changeClasses=params.activeOverlay.data('overlay-change');params.allBody.on('keyup',params.keyBodyListener=function(e){if(e.which===params.escKeyCode)
finalPopup.hideOverlay()});if(!(params.activeOverlay.data('overlay-prevent')==='prevent'))
$overlays.off('click.auth').on('click.auth',params.clickBodyListener=function(e){e.stopPropagation();var $target=$(e.target);if(!$target.parents('.'+params.groupContClass).length&&!$target.hasClass(params.groupContClass))
finalPopup.hideOverlay()});if(params.isMobile){if(params.activeOverlay.find('textarea').length&&navigator.userAgent.match(/(iPad)/g))
params.activeOverlay.find('textarea').on('focus',function(e){params.myScroll.destroy()}).on('blur',function(e){setTimeout(function(){params.myScroll=new IScroll(params.activeOverlay.get(0),{bounce:true,tap:true,preventDefaultException:{tagName:/^(INPUT|LABEL|A|TEXTAREA|BUTTON|DIV|SPAN|P|FOOTER|SELECT)$/}})},100)});params.window.on('resize',function(e){if(window.innerWidth>767){params.isTablet=true;finalPopup.initiScroll()}else if(params.isTablet){finalPopup.destroyiScroll();params.isTablet=false}})}},recalc:function($overlays){var params=this.params;var $tabContainer=$overlays.find('.'+params.tabContainerClass);if(!params.isMobile){setTimeout(function(){$tabContainer.css('height',params.$nextActive.height());},0);var isSafari=/constructor/i.test(window.HTMLElement);setTimeout(function(){$tabContainer.css('height','');},!isSafari?200:0);}},initiScroll:function(){var params=this.params;if(!params.activeOverlay)
return;params.scroller=params.activeOverlay.find('.i-popup');params.scrollerHeight=params.scroller.innerHeight();params.myScroll=new IScroll(params.activeOverlay.get(0),{bounce:true,tap:true,preventDefaultException:{tagName:/^(INPUT|LABEL|A|TEXTAREA|BUTTON|DIV|SPAN|P|FOOTER|SELECT)$/}});setTimeout(function(){if(params.myScroll)
params.myScroll.refresh()},100);params.popupInterval=setInterval(function(){var newScrollHeight=params.scroller.innerHeight();if(newScrollHeight!==params.scrollerHeight){params.scrollerHeight=newScrollHeight;if(params.myScroll)
params.myScroll.refresh()}},500);params.activeOverlay.find('input, textarea').on('blur',function(e){params.activeOverlay.scrollTop(0)})},changeState:function(state,$button){var params=this.params;if(!params.currentPopup)
params.currentPopup=$('.i-popup').eq(0);params.activeState=$button.parents('.i-popup__group');if(state==='second'){if(params.currentPopup.find('.i-popup__group:visible').attr('data-popup-state')=='third'){params.activeState=params.currentPopup.find('.i-popup__group:visible');params.activeState.addClass(params.groupHiddenClass).addClass(params.groupExclClass);params.secondState.removeClass(params.groupExclClass);setTimeout(function(){Auth.hideErrors();Auth.showFocus();params.secondState.removeClass(params.groupHiddenClass);if(params.isMobile)
if(params.isTablet&&params.myScroll){setTimeout(function(){params.myScroll.refresh()},150)}else
params.window.scrollTop(0)},0)}else{params.currentPopup.removeClass(params.rotateClass2).addClass(params.rotateClass);params.activeState.addClass(params.groupHiddenClass);setTimeout(function(){if(params.isMobile&&params.isTablet&&params.myScroll)
params.myScroll.scrollTo(0,0);params.activeState.addClass(params.groupExclClass);params.secondState.removeClass(params.groupHiddenClass+' '+params.groupExclClass);Auth.hideErrors();Auth.showFocus();if(params.isMobile)
if(params.isTablet&&params.myScroll){setTimeout(function(){params.myScroll.refresh()},150)}else
params.window.scrollTop(0)},180)}}else if(state==='third'){params.currentPopup.removeClass(params.rotateClass2).addClass(params.rotateClass);params.activeState.addClass(params.groupHiddenClass);setTimeout(function(){if(params.isMobile&&params.isTablet&&params.myScroll)
params.myScroll.scrollTo(0,0);params.activeState.addClass(params.groupExclClass);params.thirdState.removeClass(params.groupHiddenClass+' '+params.groupExclClass);Auth.hideErrors();Auth.showFocus();if(params.isMobile)
if(params.isTablet&&params.myScroll){setTimeout(function(){params.myScroll.refresh()},150)}else
params.window.scrollTop(0)},180)}else{if(params.isMobile&&params.isTablet)
params.myScroll.scrollTo(0,0);if(params.currentPopup.find('.i-popup__group:visible').attr('data-popup-state')=='third'){params.currentPopup.removeClass(params.rotateClass).addClass(params.rotateClass2);params.activeState=params.currentPopup.find('.i-popup__group:visible');params.activeState.addClass(params.groupHiddenClass);setTimeout(function(){Auth.hideErrors();Auth.showFocus();if(params.isMobile)
if(params.isTablet&&params.myScroll){setTimeout(function(){params.myScroll.refresh()},150)}else
params.window.scrollTop(0)},0);setTimeout(function(){params.activeState.addClass(params.groupExclClass);params.firstState.removeClass(params.groupExclClass);params.firstState.removeClass(params.groupHiddenClass);},180);}else{params.currentPopup.removeClass(params.rotateClass).addClass(params.rotateClass2);params.activeState.addClass(params.groupHiddenClass);setTimeout(function(){if(params.isMobile&&params.isTablet)
params.myScroll.scrollTo(0,0);params.activeState.addClass(params.groupExclClass);params.firstState.removeClass(params.groupHiddenClass+' '+params.groupExclClass);Auth.hideErrors();Auth.showFocus();params.currentPopup.one('animationend animationend webkitAnimationEnd oanimationend MSAnimationEnd',function(e){params.currentPopup.removeClass(params.rotateClass2)});if(params.isMobile)
if(params.isTablet){setTimeout(function(){params.myScroll.refresh()},150)}else
params.window.scrollTop(0)},180)}}},hideOverlay:function(){var params=this.params;params.allBody.off('keyup',params.keyBodyListener).off('click',params.clickBodyListener).parents('html').removeClass('html_has-overlay');if(params.isMobile){if(params.isTablet)
this.destroyiScroll()}else{this.resetAdjustments();this.resetScrollbar()};if($('#auth_fr').length)
$('#auth_fr').remove();if(params.popups)
params.popups.removeClass(params.processingClass);params.activeOverlay.addClass(finalPopup.params.hideOverlayClass);params.activeOverlay=undefined;try{Auth.stopAutofill()}catch(ex){};setTimeout(function(){if(params.currentPopup)
params.currentPopup.removeClass(params.rotateClass+' '+params.rotateClass2);if(params.firstState){params.allGroups.addClass(params.groupHiddenClass+' '+params.groupExclClass);params.firstState.removeClass(params.groupHiddenClass+' '+params.groupExclClass)}},500)},destroyiScroll:function(){var params=this.params;clearInterval(params.popupInterval);if(params.myScroll)
params.myScroll.destroy();params.myScroll=null;params.activeOverlay.find('input, textarea').off('blur')},checkScrollbar:function(){var fullWindowWidth=window.innerWidth;this.bodyIsOverflowing=document.body.clientWidth<fullWindowWidth;this.scrollbarWidth=this.measureScrollbar()},setScrollbar:function(){var bodyPad=parseInt((this.params.allBody.css('padding-right')||0),10);this.originalBodyPad=document.body.style.paddingRight||'';if(this.bodyIsOverflowing)
this.params.allBody.css('padding-right',bodyPad+this.scrollbarWidth).css('background-position','calc(50% - '+this.scrollbarWidth/2+'px) 0')},resetScrollbar:function(){this.params.allBody.css('padding-right',this.originalBodyPad).css('background-position','')},resetAdjustments:function(){this.params.activeOverlay.css({paddingLeft:'',paddingRight:''})},measureScrollbar:function(){var scrollDiv=document.createElement('div');$(scrollDiv).css({position:'absolute',top:"-9999px",width:'50px',height:'50px',overflow:'scroll'});this.params.allBody.append(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;this.params.allBody[0].removeChild(scrollDiv);return scrollbarWidth},adjustDialog:function(){var modalIsOverflowing=this.params.activeOverlay.get(0).scrollHeight>document.documentElement.clientHeight;this.params.activeOverlay.css({paddingLeft:!this.bodyIsOverflowing?this.scrollbarWidth:''})}};return finalPopup.init($('#auth-overlay, #auth-layout'))}())});;