RegExp.quote=function(str){return(str+'').replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");};var itemCount=1;function _renderItem(ul,item){var term=jQuery.trim(this.term);term=term.split(" ").sort().reverse();var is_single;var allarr=new Array();for(var i=0;i<term.length;i++){var tmp_term=term[i].split(/[-./\\,:;`@+]/gi);is_single=true;for(var j=0;j<tmp_term.length;j++){if(tmp_term[j].length>0){allarr.push(tmp_term[j]);}
if(tmp_term[j].length>1){is_single=false;}}
if(tmp_term.length>1){allarr.push(term[i]);if(is_single){allarr.push(term[i].replace(/[.,-]/gi,''));}}}
term=allarr.sort().reverse().join('|');term=term.replace(/([+-\/])/gi,"\\$1");var pattern="(^|[ -./\\,:;`@+])("+term+")";var re=new RegExp(pattern,"gi");var val=item.value;var t=item.value.replace(re,"$1<strong style='color: #333; font-weight: bold;'>$2</strong>");t=item.label.replace(re,"$1<strong style='color: #333; font-weight: bold;'>$2</strong>");return renderByType(item.type,item,ul,t);}
function _renderMenu($ul,items){var self=this;itemCount=1;jQuery.each(items,function(index,arr){jQuery.each(arr.values,function(i,item){item.type=arr.type;self._renderItemData($ul,item,(index+1)*(i+1));if(i===arr.values.length-1){$ul.find('li').last().addClass('last-item');}});});}
function renderByType(type,item,ul,text){switch(type){case'catalog':return renderCatalog(item,ul,text,itemCount++);break;case'people':return renderPeople(item,ul,text,itemCount++);break;case'producer':return renderProducer(item,ul,text,itemCount++);break;case'goods':return renderGoods(item,ul,text,itemCount++);break;case'lot':return renderLot(item,ul,text,itemCount++);break;default:return renderPhrase(item,ul,text,itemCount++);}}
function renderPhrase(item,ul,text,index){return jQuery('<li></li>').data("item.autocomplete",item).append("<a data-index='"+index+"' class='suggest-link suggest-link_simple' href='"+item.link+"' style='font-weight:normal; color: #333;'>"+text+(item.labelAdds?' '+item.labelAdds:'')+"</a>").appendTo(ul);}
function renderCatalog(item,ul,text,index){return jQuery('<li></li>').data("item.autocomplete",item).append("<a data-index='"+index+"' class='suggest-link suggest-link_simple' href='"+item.link+"' style='font-weight:normal; color: #333;'>"+text+"</a>").appendTo(ul);}
function renderPeople(item,ul,text,index){return jQuery('<li></li>').data("item.autocomplete",item).append("<a data-index='"+index+"' class='suggest-menu-row' href='"+item.link+"' style='font-weight:normal; color: #333;'>"+"<span class='suggest-menu-overlay'></span>"+"<span class='suggest-menu-column suggest-menu-column_short'>"+"<img class='suggest-menu-image' src='"+item.logo+"'/>"+"</span>"+"<span class='suggest-menu-column suggest-menu-column_long'>"+"<span class='suggest-menu-line'>"+
text+"</span>"+"<span class='suggest-menu-line suggest-menu-line_opt'>"+
item.smallDesc+"</span>"+"</span>"+"</a>").appendTo(ul);}
function renderProducer(item,ul,text,index){return jQuery('<li></li>').data("item.autocomplete",item).append("<a data-index='"+index+"' class='suggest-menu-row suggest-menu-row_fixed' href='"+item.link+"' style='font-weight:normal; color: #333;'>"+"<span class='suggest-menu-overlay'></span>"+"<span class='suggest-menu-column suggest-menu-column_short'>"+"<img class='suggest-menu-image suggest-menu-image_limited' src='"+item.logo+"'/>"+"</span>"+"<span class='suggest-menu-column suggest-menu-column_long'>"+"<span class='suggest-menu-line'>"+
text+"</span>"+"</span>"+"</a>").appendTo(ul);}
function renderGoods(item,ul,text,index){return jQuery('<li></li>').data("item.autocomplete",item).append("<a data-index='"+index+"' class='suggest-menu-row' href='"+item.link+"' style='font-weight:normal; color: #333;'>"+"<span class='suggest-menu-overlay'></span>"+"<span class='suggest-menu-column suggest-menu-column_short'>"+"<img class='suggest-menu-image' src='"+item.logo+"'/>"+"</span>"+"<span class='suggest-menu-column suggest-menu-column_long'>"+"<span class='suggest-menu-line'>"+
text+"</span>"+"<span class='suggest-menu-line suggest-menu-line_opt'>"+
item.smallDesc+"</span>"+"<span class='suggest-menu-line"+(item.discount?" suggest-menu-line_hot":"")+"'>"+
item.price+
(item.discount?("<span class='suggest-menu-discount'>"+item.discount+"</span>"):"")+"</span>"+
(item.oldPrice?("<span class='suggest-menu-line suggest-menu-line_strike'>"+item.oldPrice):"")+"</span>"+"</span>"+"</a>").appendTo(ul);}
function renderLot(item,ul,text,index){return jQuery('<li></li>').data("item.autocomplete",item).append("<a data-index='"+index+"' class='suggest-menu-row' href='"+item.link+"' style='font-weight:normal; color: #333;'>"+"<span class='suggest-menu-overlay'></span>"+"<span class='suggest-menu-column suggest-menu-column_short'>"+"<img class='suggest-menu-image' src='"+item.logo+"'/>"+"</span>"+"<span class='suggest-menu-column suggest-menu-column_long'>"+"<span class='suggest-menu-line'>"+
text+"</span>"+"<span class='suggest-menu-line suggest-menu-line_opt'>"+
(item.bids?"<span class='suggest-menu-item'>"+item.bids+"</span>":"")+
(item.time?"<span class='suggest-menu-item'>"+item.time+"</span>":"")+"</span>"+
(item.bidsCost?"<span class='suggest-menu-line'>"+item.bidsCost+"</span>":"")+
(item.fixedCost?"<span class='suggest-menu-line suggest-menu-line_hot suggest-menu-line_top'>"+item.fixedCost+"</span>":"")+"</a>").appendTo(ul);}
jQuery('#top-s').ready(function(){jQuery(function(){var cache={};var _s=jQuery('#top-s');var _sHint=jQuery('#top_s_hint');var $form=jQuery('#search-top');var $panel=_s.parents('.top-panel');var dropdownOpenClass='search-suggest_open';var forcedOpenClass='top-panel_forced-open';var fixedClass='html_header-fixed';var isMobile=jQuery('html').hasClass('mobile-yes');var $html=jQuery('html, body');var windowW=jQuery(window).width();var isAy=_s.data('project')==='ay';var dropTransition=150;var mobileBreakpoint=768;var autoPopup,scrollOffset;var itemIsSelected=false;_s.on('keydown',function(e){if(_sHint.length){if((e.keyCode==9||e.keyCode==39)&&_s.val()!=''&&_sHint.val().length>_s.val().length){_s.val(_sHint.val());_sHint.val('');_s.autocomplete('search');if(e.keyCode==9){e.preventDefault();}}}});function hint_search(kwd,term){if(kwd&&kwd.indexOf(term)===0&&_s.val()==term){_sHint.val(kwd);}}
if(windowW<mobileBreakpoint){_s.on('focus.scrolling',function(){setTimeout(function(){$html.animate({'scrollTop':_s.offset().top-15},{duration:200});},50);})}
if(isMobile){_s.attr('placeholder',windowW<mobileBreakpoint?'Поиск':'Введите название товара').on('focus.openOnFocus',function(){if(_s.val()){_s.autocomplete('search');}});}
_s.on('autocompletecreate',function(){setTimeout(function(){autoPopup=jQuery('.search-suggest');if(isMobile){autoPopup.on('click.focusClick',function(e){e.preventDefault();if(e.target.tagName==='A'){_s.trigger('blockBlur');autoPopup.find('a[data-index='+e.target.getAttribute('data-index')+']').addClass('focused-state');}});}},0);}).autocomplete({appendTo:'#search-dropdown',minLength:2,position:{my:isMobile?'left top':'left top+1'},delay:10,autoFocus:false,source:function(request,response){var term=request.term.replace(/^\s+/,"");if(_sHint.length&&_sHint.val().indexOf(term)!==0){_sHint.val('');}
if(term.length<2){return;}
if(term in cache){response(cache[term]);if(cache[term].length){hint_search(cache[term][0].values[0].value,request.term);}
return;}
if(jQuery('#oztxt').length){request.oztxt=1;}
if(jQuery('#top-s').length&&jQuery('#top-s').data('clpid')){request.cl_pid=jQuery('#top-s').data('clpid');}
if(jQuery('#top-s').length&&jQuery('#top-s').data('hpid')){request.cl_hpid=jQuery('#top-s').data('hpid');}
var domain2ndLevel=location.hostname.split('.').slice(-2).join('.');var url=location.protocol+"//"+domain2ndLevel+"/search/instant.php";var dataType='jsonp';jQuery.ajax({url:url,data:request,crossDomain:true,dataType:dataType,success:function(data,status,xhr){cache[term]=data;response(data);if(data.length){hint_search(data[0].value,request.term);}},error:function(xhr,errText,error){}});},open:function(event,ui){var $t=jQuery(this);setPos();jQuery(window).on('resize.ocomp',setPos);autoPopup.addClass(dropdownOpenClass);$html.eq(0).addClass(fixedClass);function setPos(){autoPopup.css({left:($t.offset().left+(isMobile?1:0))+'px',width:($t[0].offsetWidth-(isMobile?2:(!isAy?0.5:-0.3)))+'px'});}
if(isMobile){jQuery(window).on('scroll.onOpenScroll',function(){scrollOffset=window.pageYOffset;});}},close:function(){if(isMobile)jQuery(window).off('scroll.onOpenScroll');if(!itemIsSelected){autoPopup.css('display','block').removeClass(dropdownOpenClass);$html.eq(0).removeClass(fixedClass);}else{window.addEventListener('scroll',function(){window.scrollTo(0,scrollOffset);});autoPopup.css('display','block').addClass(dropdownOpenClass);$html.eq(0).removeClass(fixedClass);$panel.addClass(forcedOpenClass);}
jQuery(window).off('resize.ocomp');if(_sHint.length&&!itemIsSelected){_sHint.val('');}
setTimeout(function(){if(!itemIsSelected)autoPopup.css('display','none');},dropTransition);},change:function(event,ui){if(_sHint.length){_sHint.val('');}},focus:function(event,ui){if(event.keyCode&&_sHint.length){_sHint.val('');}},select:function(event,ui){if(isMobile)itemIsSelected=true;setTimeout(function(){window.location=ui.item.link;},isMobile?1000:0);}}).data('ui-autocomplete').menu.element.addClass('search-suggest');jQuery.extend(_s.data("ui-autocomplete"),{_renderItem:_renderItem,_renderMenu:_renderMenu});$form.submit(function(e){var term=_s.val().replace(/^\s+/,"");if(!term.length){e.preventDefault();return false;}});});});;