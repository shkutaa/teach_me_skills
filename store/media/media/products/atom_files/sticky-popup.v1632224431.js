var $html=jQuery('html');function StickyPopup(options){this.$el=jQuery(options.elementId);this.$overlay=this.$el.find('.sticky-popup__overlay');this.$popup=this.$el.find('.sticky-popup__inner');this.$closingEl=this.$el.find('.sticky-popup__control');this.$openingElContainer=this.$el.find('.sticky-popup__outer');this.$openingEl=this.$openingElContainer.find('.i-button');this.classNames={minimized:'sticky-popup__inner_minimized',processing:'sticky-popup__inner_processing',closed:'sticky-popup__inner_closed',fullscreen:'sticky-popup_fullscreen',initial:'sticky-popup_initial',overlayFading:'sticky-popup__overlay_fading',elFading:'sticky-popup_fading',rootHasOverlay:'html_has-overlay'};this.onShow=options.onShow;this.subscribePhonePopupCookie=options.subscribePhonePopupCookie;this.checkState();this.setListeners();}
jQuery.extend(StickyPopup.prototype,{checkState:function(){var self=this;if(this.$el.hasClass(this.classNames.fullscreen)){this.isInOverlayMode=true;$html.addClass(this.classNames.rootHasOverlay);}
if(this.$el.hasClass(this.classNames.initial)){setTimeout(function(){self.$el.removeClass(self.classNames.initial);},1000);}
if(this.onShow)this.onShow();this.isSmartphone=$html.hasClass('mobile-yes')&&jQuery(window).width()<768;this.isIos=$html.hasClass('html_ios');if(this.isInOverlayMode&&this.isIos&&!this.isSmartphone)this.iosFix();},setListeners:function(){var self=this;this.$closingEl.on('click',function(e){e.preventDefault();self.hide();self.setSubscribePopupCookie();});this.$openingEl.on('click',function(e){e.preventDefault();self.show();});},show:function(){this.$popup.removeClass(this.classNames.minimized);if(this.onShow)this.onShow();},hide:function(){var self=this;if(this.isInOverlayMode){this.stickToBottom(function(){self._addHidingClass();},true)}else{this._addHidingClass();if(this.$el.data('on-hide')==='destroy'){this.close();}}},_addHidingClass:function(){this.$popup.addClass(this.classNames.minimized);},stickToBottom:function(cb,toShift){var $window=jQuery(window),self=this,windowH=$window.height(),windowW=$window.width(),popupH=this.$popup.outerHeight(),popupW=this.$popup.outerWidth(),popupY=this.$popup.offset().top-$window.scrollTop(),popupX=this.$popup.offset().left,posX=(windowW>1400?getNewOffset():(windowW-340))-popupX+(toShift?(popupW/2):0),posY=windowH-(toShift?-popupH:popupH)-popupY;function getNewOffset(){var leftSpace=(windowW-1400)/2;return leftSpace+(1400-340);}
this.$popup.css({transform:this.isSmartphone?'translate3d(0, '+posY+'px, 0)':'translate3d('+posX+'px, '+posY+'px, 0)',width:toShift?'':this.isSmartphone?'':'320px'});this.$overlay.addClass(this.classNames.overlayFading);this.isInOverlayMode=false;setTimeout(function(){self.$popup.css({transform:'',transition:'none'});self.$el.removeClass(self.classNames.fullscreen);$html.removeClass(self.classNames.rootHasOverlay);if(self.isIos&&!self.isSmartphone)self.iosFix(true);setTimeout(function(){self.$popup.css({transition:'',width:''});},200);if(cb)cb();},500);},setProcessing:function(){this.$popup.addClass(this.classNames.processing);},unsetProcessing:function(){this.$popup.removeClass(this.classNames.processing);},close:function(){var self=this;if(this.isInOverlayMode){self.$el.addClass(this.classNames.elFading);}else{this.$popup.addClass(this.classNames.closed);}
setTimeout(function(){self.$el.remove();if(self.isInOverlayMode){$html.removeClass(self.classNames.rootHasOverlay);self.iosFix(true);}},350);},iosFix:function(remove){jQuery('#minWidth').css({'position':!remove?'fixed':''});this.$el.css({'position':!remove?'absolute':''});},setSubscribePopupCookie:function(){var date=new Date(new Date().getTime()+30*24*60*60*1000);document.cookie=this.subscribePhonePopupCookie+"=1; path=/; expires="+date.toUTCString();}});;